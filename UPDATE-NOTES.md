# WireGuard All-in-One 脚本更新说明

## 🎉 版本 2.1.0 - Windows客户端智能优化

### 🆕 新增功能

#### 1. Windows客户端智能识别
- **自动检测客户端类型**: 添加客户端时可选择Windows或其他类型
- **专门优化配置**: 为Windows客户端提供专门的优化设置
- **智能配置文件命名**: 根据客户端类型和模式自动命名

#### 2. 双流量模式支持
**全局代理模式 (Global)**
- 所有网络流量都通过VPN
- 完全的IP地址隐藏和隐私保护
- 适合网络隐私保护、绕过地理限制
- 配置文件: `客户端名-global.conf`

**内网访问模式 (Internal)**
- 仅内网流量通过VPN
- 本地网络访问不受影响
- 适合远程办公、访问公司内网资源
- 配置文件: `客户端名-internal.conf`

#### 3. Windows专用优化
- **MTU优化**: 自动设置为1420，避免数据包分片
- **DNS优化**: 根据模式选择最优DNS服务器
- **连接保活**: PersistentKeepalive=25，防止连接断开
- **使用说明**: 自动显示Windows客户端配置指南

### 🔧 功能改进

#### 1. 客户端列表增强
- **类型显示**: 显示客户端类型（普通/Windows全局/Windows内网）
- **统计信息**: 显示总客户端数、在线数、离线数
- **智能去重**: Windows客户端不会重复显示
- **特别说明**: 为Windows客户端显示模式说明

#### 2. 配置生成优化
- **分离函数**: 普通客户端和Windows客户端使用不同的生成函数
- **配置验证**: 检查配置文件冲突，避免重复创建
- **详细说明**: 生成配置后显示详细的使用说明

#### 3. 用户体验改进
- **交互式选择**: 清晰的菜单和选项说明
- **颜色标识**: 使用不同颜色区分不同类型的信息
- **操作指导**: 每步操作后提供后续操作建议

### 📋 使用方法

#### 快速开始
```bash
# 下载并运行最新版本
wget https://raw.githubusercontent.com/senma231/WG-install/main/wireguard-all-in-one.sh && chmod +x wireguard-all-in-one.sh && sudo ./wireguard-all-in-one.sh
```

#### 添加Windows客户端
1. 运行脚本: `sudo ./wireguard-all-in-one.sh`
2. 选择 "2. 添加客户端"
3. 选择 "1. Windows客户端（推荐，包含优化配置）"
4. 选择流量模式:
   - "1. 全局代理模式" - 所有流量通过VPN
   - "2. 内网访问模式" - 仅访问内网资源

#### 配置文件说明
- **全局代理**: `laptop-global.conf`
  ```ini
  [Interface]
  PrivateKey = <私钥>
  Address = 10.66.0.2/24
  DNS = 223.5.5.5, 119.29.29.29, 8.8.8.8
  MTU = 1420

  [Peer]
  PublicKey = <服务端公钥>
  Endpoint = <服务端IP>:51820
  AllowedIPs = 0.0.0.0/0
  PersistentKeepalive = 25
  ```

- **内网访问**: `office-internal.conf`
  ```ini
  [Interface]
  PrivateKey = <私钥>
  Address = 10.66.0.3/24
  DNS = 223.5.5.5, 119.29.29.29
  MTU = 1420

  [Peer]
  PublicKey = <服务端公钥>
  Endpoint = <服务端IP>:51820
  AllowedIPs = 10.66.0.0/16, 192.168.0.0/16, 172.16.0.0/12
  PersistentKeepalive = 25
  ```

### 🔍 客户端列表显示

更新后的客户端列表显示效果：
```
客户端名称               IP地址          类型         状态
================================================================
laptop                  10.66.0.2       Windows(全局) 在线
office                  10.66.0.3       Windows(内网) 离线
phone                   10.66.0.4       普通         在线

总客户端数: 3 | 在线: 2 | 离线: 1

Windows客户端说明：
• 全局模式：所有流量通过VPN
• 内网模式：仅访问服务端内网资源
```

### 🎯 适用场景

#### 全局代理模式适合：
- 🌍 需要完全的网络隐私保护
- 🔒 绕过地理位置限制
- 🛡️ 在不安全的网络环境中保护数据
- 📱 移动办公时的网络安全

#### 内网访问模式适合：
- 🏢 远程办公访问公司内网
- 💻 访问服务端的内网服务
- 🔧 系统管理和维护
- 📊 不影响本地网络性能的场景

### 🔧 技术细节

#### Windows客户端优化参数
- **MTU**: 1420 (避免分片，提高性能)
- **PersistentKeepalive**: 25秒 (保持连接稳定)
- **DNS**: 根据模式优化选择
- **AllowedIPs**: 根据模式精确配置

#### 配置文件管理
- **命名规则**: `客户端名-模式.conf`
- **存储位置**: `/etc/wireguard/clients/`
- **权限控制**: 600 (仅root可读写)
- **冲突检测**: 自动检查重名配置

### 🚀 性能提升

#### 连接稳定性
- Windows专用的保活机制
- 优化的MTU设置
- 智能的DNS配置

#### 网络性能
- 内网模式减少不必要的流量转发
- 优化的路由配置
- 减少网络延迟

### 📞 使用建议

#### Windows客户端设置
1. **以管理员身份运行** WireGuard客户端
2. **允许防火墙访问** WireGuard应用
3. **选择合适的模式** 根据使用需求选择
4. **测试连接** 确保配置正确

#### 故障排查
1. **检查配置文件** 确保参数正确
2. **测试网络连通性** ping服务端IP
3. **查看客户端日志** 检查连接错误
4. **运行网络诊断** 使用脚本的诊断功能

### 🔄 升级说明

#### 从旧版本升级
1. **备份现有配置** (脚本会自动备份)
2. **下载新版本脚本**
3. **运行新脚本** 现有配置不会受影响
4. **添加新客户端** 享受新功能

#### 兼容性
- ✅ 完全向后兼容
- ✅ 现有客户端配置不受影响
- ✅ 可以混合使用新旧配置
- ✅ 支持所有原有功能

### 📚 相关文档

- **快捷命令**: `QUICK-COMMANDS.md`
- **Windows客户端指南**: `WINDOWS-CLIENT-GUIDE.md`
- **使用指南**: `USAGE_GUIDE.md`
- **部署指南**: `DEPLOYMENT.md`

---

## 🎉 总结

这次更新主要针对Windows客户端进行了深度优化，提供了更智能、更便捷的配置体验。无论是需要完全的网络代理，还是仅仅访问内网资源，都能找到最适合的配置模式。

**立即体验新功能**：
```bash
wget https://raw.githubusercontent.com/senma231/WG-install/main/wireguard-all-in-one.sh && chmod +x wireguard-all-in-one.sh && sudo ./wireguard-all-in-one.sh
```
